{% extends 'base.html' %}
{% load static %}
{% load comments %}
{% load comments_xtd %}

<title>{% block title %} {{playlist.name}} {% endblock %}</title>

<link rel="stylesheet" href="{% static 'css/style.css' %}">

{% block content %}

<br>

<body>
  <center>
    <img class="play_user_image" src="{{ playlist.user_id.profile.profile_pic.url }}">
    <h1 class="play_name">{{playlist.name}}</h1>
    <h5 class="play_creator_name">Created by: <a href="{% url 'show_user' playlist.user_id.id %}">{{playlist.user_id}}</a>
    </h5>
    {% if user.is_authenticated %}
    {% if users_playlist %}
    <div>
      {% elif already_saved %}
      <h1> <a class="btn play_save_btn" href="{% url 'unsave_playlist' playlist.id %}" role="button">Unsave
          This Playlist</a></h1>
      {% else %}
      <h1><a class="btn play_save_btn" href="{% url 'save_playlist' playlist.id %}" role="button">Save
          This
          Playlist</a></h1>
      {% endif %}

      <p class="play_upvote_words">Upvotes: {{upvotes}}</p>
      <p class="play_downvote_words">Downvotes: {{downvotes}}</p>

      {% if request.user.id != playlist.user_id.id %}
      <div class="playlist_rating_container">
        <form method="post" action="{% url 'playlist_upvote' playlist.id %}">
          {% csrf_token %}
          {% if user_upvoted %}
          <button type="submit" class="btn btn-success play_upvote_btn">Upvote</button>
          {% else %}
          <button type="submit" class="btn btn-outline-success play_upvote_btn">Upvote</button>
          {% endif %}
        </form>
        <p class="space"></p>
        <form method="post" action="{% url 'playlist_downvote' playlist.id %}">
          {% csrf_token %}
          {% if user_downvoted %}
          <button type="submit" class="btn btn-danger play_downvote_btn" data-mdb-ripple-color="dark">Downvote</button>
          {% else %}
          <button type="submit" class="btn btn-outline-danger play_downvote_btn" data-mdb-ripple-color="dark">Downvote</button>
          {% endif %}
        </form>

        {% endif %}
        {% endif %}
      </div>
    </div>

    <br>
    <a class="btn play_plus_btn" href="{% url 'playlist_song' playlist.id %}" role="button"><strong>+</strong></a>
    <br>
    <br>
    <p class="no_space"></p>
    <div class="">
    {% for song in songs %}
    <ol class="list-group">
      <li class="list-group-item song_play_card">
        <div class="ms-2 me-auto">
          <div class="fw-bold" class="">
            {{forloop.counter}}.
            <img src="{{song.album_id.cover}}" class="song_play_image"><a class="play_song_name"
              href="{% url 'songinfo' song.id %}">{{song.name}}</a>
            <br>
          </div">
          <a class="play_album_name" href="{% url 'album_info' song.album_id.id %}">{{song.album_id.name}}</a>
        </div>
          <span class="song_delete_btn"><a class="btn song_delete_btn" role="button"
            href="{% url 'delete_song' playlist.id song.id %}">Delete</a></span>
      </li>
    </ol>
    {% endfor %}
    </div>

    {% get_comment_count for playlist as comment_count %}
    <div class="py-4 text-center">
      <a href="{% url 'playlists' %}">Back to playlists</a>
      &nbsp;&sdot;&nbsp;
      {{ comment_count }} comment{{ comment_count|pluralize }}
      ha{{ comment_count|pluralize:"s,ve"}} been posted.
    </div>

    {% if comment_count %}
    <ul class="media-list">
      {% render_xtdcomment_tree for playlist allow_flagging allow_feedback show_feedback %}
    </ul>
    {% endif %}

    {% if playlist.allow_comments %}
    <div class="comment mt-3 mb-5">
      <h4 class="text-center mb-4">Post a Comment</h4>
      <div class="card pt-4 p_comment_size">
        {% render_comment_form for playlist %}
      </div>
      {% endif %}
    </div>
  </center>
</body>
{% endblock %}
{% extends 'base.html' %}
{% load static %}

{% block content %}

<script type="text/javascript">

  function vote(song_id, up_or_down) {
    $.ajax({
        // Our sample url to make request
        url: '{% url "vote" %}',
        // Type of Request
        type: "POST",
        data : { 'vote' : up_or_down, 'song' : song_id ,'csrfmiddlewaretoken' : "{{ csrf_token }}" },
        // Function to call when to
        // request is ok
        success: function(data) {
            var x = data;
            if(!(x === 'not logged in')){
              ratings = document.getElementById(song_id + "-rating");
              ratings.innerHTML =  parseInt(ratings.innerHTML) + parseInt(x);
            }
        },
        // Error handling
        error: function (error) {
            console.log(`Error ${error}`);
        }
    });
  }

</script>


{% for item in recommendations %}
<div class="card dash_card">
  <div class="card-body">
    <iframe class="dash_iframe" src="https://open.spotify.com/embed/track/{{item.song.id}}?utm_source=generator" width="100%" height="80"
     frameBorder="0" allowfullscreen=""
     allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture">
    </iframe>
    <p id="{{item.song.id}}-rating">
      {{item.ratings}}
    <p/>

    {% if user.id %}

      <button class="btn btn-primary", onclick="vote('{{item.song.id}}', 1)">Upvote</button>
      <button class="btn btn-primary", onclick="vote('{{item.song.id}}', 0)">Downvote</button>

    {% endif %}

    <a href="{% url 'songinfo' item.song.id  %}" class="btn btn-primary">Comments</a>
  </div>
</div>

{% endfor %}

{% endblock %}
